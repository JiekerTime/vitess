[
  {
    "comment": "scatter aggregate in a subquery",
    "query": "select a from (select count(*) as a from t_user) t",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select a from (select count(*) as a from t_user) t",
      "Instructions": {
        "OperatorType": "Aggregate",
        "Variant": "Scalar",
        "Aggregates": "sum_count_star(0) AS a",
        "Inputs": [
          {
            "OperatorType": "TableRoute",
            "Variant": "Scatter-Scatter",
            "Keyspace": {
              "Name": "user",
              "Sharded": true
            },
            "FieldQuery": "select count(*) as a from t_user_0 where 1 != 1",
            "Query": "select count(*) as a from t_user",
            "Table": "t_user"
          }
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "Aggregations from derived table used in arithmetic outside derived table",
    "query": "select A.a, A.b, (A.a / A.b) as d from (select sum(a) as a, sum(b) as b from t_user) A",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select A.a, A.b, (A.a / A.b) as d from (select sum(a) as a, sum(b) as b from t_user) A",
      "Instructions": {
        "OperatorType": "Projection",
        "Expressions": [
          "[COLUMN 0] as a",
          "[COLUMN 1] as b",
          "[COLUMN 0] / [COLUMN 1] as d"
        ],
        "Inputs": [
          {
            "OperatorType": "Aggregate",
            "Variant": "Scalar",
            "Aggregates": "sum(0) AS a, sum(1) AS b",
            "Inputs": [
              {
                "OperatorType": "TableRoute",
                "Variant": "Scatter-Scatter",
                "Keyspace": {
                  "Name": "user",
                  "Sharded": true
                },
                "FieldQuery": "select sum(a) as a, sum(b) as b from t_user_0 where 1 != 1",
                "Query": "select sum(a) as a, sum(b) as b from t_user",
                "Table": "t_user"
              }
            ]
          }
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "correlated subquery on sharding key with group by a unique vindex with having clause.",
    "query": "select count(*) from t_user where exists (select 1 from t_user_extra where user_id = t_user.id group by user_id having max(col) > 10)",
    "plan":"VT12001: unsupported: subquery in split table"
  }
]