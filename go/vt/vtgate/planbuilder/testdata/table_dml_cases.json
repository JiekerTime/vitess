[
  {
    "comment": "delete from user without a where clause",
    "query": "delete from t_user",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete with binary value",
    "query": "delete from t_user where name = _binary 'abc'",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where name = _binary 'abc'",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Equal-Scatter",
        "Vindex": "name_user_map",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where `name` = _binary 'abc'",
        "Values": [
          "VARBINARY(\"abc\")"
        ],
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from where",
    "query": "delete from t_user where id = 1",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where id = 1",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ],
        "Vindex": "user_index"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from where",
    "query": "delete from t_user where col = 1",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where col = 1",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where col = 1",
        "Table": "t_user",
        "TableValues": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "QueryType": "DELETE",
    "Original": "delete from t_user where id = 5 and col = 6",
    "Instructions": {
      "OperatorType": "TableDelete",
      "Variant": "EqualUnique-EqualUnique",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "TargetTabletType": "PRIMARY",
      "Queries": "delete from t_user where id = 5 and col = 6",
      "Table": "t_user",
      "TableValues": [
        "INT64(6)"
      ],
      "Values": [
        "INT64(5)"
      ],
      "Vindex": "user_index"
    },
    "TablesUsed": [
      "user.t_user"
    ]
  },
  {
    "comment": "delete from t_user by primary keyspace id with in clause",
    "query": "delete from t_user where id in (1, 2, 3)",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where id in (1, 2, 3)",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "IN-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where id in (1, 2, 3)",
        "Table": "t_user",
        "Values": [
          "(INT64(1), INT64(2), INT64(3))"
        ],
        "Vindex": "user_index"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from t_user with split table key",
    "query": "delete from t_user where col in (1, 2, 3)",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where col in (1, 2, 3)",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-IN",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where col in (1, 2, 3)",
        "Table": "t_user",
        "TableValues": [
          "(INT64(1), INT64(2), INT64(3))"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from t_user by complex expression",
    "query": "delete from t_user where id + 1 = 2",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where id + 1 = 2",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where id + 1 = 2",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "multi-table delete with single table",
    "query": "delete u.* from t_user u where u.id * u.col = u.foo",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete u.* from t_user u where u.id * u.col = u.foo",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where t_user.id * t_user.col = t_user.foo",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete with alias table",
    "query": "delete from t_user u where u.col > 20",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user u where u.col > 20",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user as u where u.col > 20",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from where multi in",
    "query": "delete from t_user where (name, col) in (('aa', 'bb'), ('cc', 'dd'))",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where (name, col) in (('aa', 'bb'), ('cc', 'dd'))",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "MultiEqual-MultiEqual",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where (`name`, col) in (('aa', 'bb'), ('cc', 'dd'))",
        "Table": "t_user",
        "Values": [
          "(VARCHAR(\"aa\"), VARCHAR(\"cc\"))"
        ],
        "Vindex": "name_user_map",
        "TableValues": [
          "(VARCHAR(\"bb\"), VARCHAR(\"dd\"))"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete with non-comparison expr",
    "query": "delete from t_user where id between 1 and 2",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where id between 1 and 2",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where id between 1 and 2",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete from with no index match",
    "query": "delete from t_user where name = 'jose'",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where name = 'jose'",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "Equal-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where `name` = 'jose'",
        "Table": "t_user",
        "Values": [
          "VARCHAR(\"jose\")"
        ],
        "Vindex": "name_user_map"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "delete limit with shard key",
    "query": "delete from t_user where id=5 limit 5",
    "plan": "VT12001: unsupported: multi split tables DELETE with LIMIT"
  },
  {
    "comment": "delete limit with shard key and split table key",
    "query": "delete from t_user where id=5 and col=6 limit 7",
    "plan": {
      "QueryType": "DELETE",
      "Original": "delete from t_user where id=5 and col=6 limit 7",
      "Instructions": {
        "OperatorType": "TableDelete",
        "Variant": "EqualUnique-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Queries": "delete from t_user where id = 5 and col = 6 limit 7",
        "Table": "t_user",
        "TableValues": [
          "INT64(6)"
        ],
        "Values": [
          "INT64(5)"
        ],
        "Vindex": "user_index"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by primary keyspace id",
    "query": "update t_user set val = 1 where id = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where id = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by split table key",
    "query": "update t_user set name='123' where col=5",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set name='123' where col=5",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set `name` = '123' where col = 5",
        "Table": "t_user",
        "TableValues": [
          "INT64(5)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by primary keyspace id with alias",
    "query": "update t_user as user_alias set val = 1 where user_alias.id = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user as user_alias set val = 1 where user_alias.id = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user as user_alias set val = 1 where user_alias.id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by split table key with alias",
    "query": "update t_user as user_alias set val = 1 where user_alias.col = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user as user_alias set val = 1 where user_alias.col = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user as user_alias set val = 1 where user_alias.col = 1",
        "Table": "t_user",
        "TableValues": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by primary keyspace id with parenthesized expression",
    "query": "update t_user set val = 1 where (id = 1)",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where (id = 1)",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by primary keyspace id with multi-part where clause with parens",
    "query": "update t_user set val = 1 where (name = 'foo' and id = 1)",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where (name = 'foo' and id = 1)",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where `name` = 'foo' and id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by primary keyspace id, stray where clause",
    "query": "update t_user set val = 1 where id = id2 and id = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where id = id2 and id = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where id = id2 and id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by split table key, stray where clause",
    "query": "update t_user set val = 1 where col = col2 and col = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where col = col2 and col = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where col = col2 and col = 1",
        "Table": "t_user",
        "TableValues": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by split table key, stray where clause with conversion error",
    "query": "update t_user set val = 1 where col = 18446744073709551616 and col = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where col = 18446744073709551616 and col = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where col = 18446744073709551616 and col = 1",
        "Table": "t_user",
        "TableValues": [
          "DECIMAL(18446744073709551616)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update by split table key, stray where clause with conversion error",
    "query": "update t_user set val = 1 where id = 1 and id = 18446744073709551616",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1 where id = 1 and id = 18446744073709551616",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1 where id = 1 and id = 18446744073709551616",
        "Table": "t_user",
        "Values": [
          "DECIMAL(18446744073709551616)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "scatter update",
    "query": "update t_user set val = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set val = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set val = 1",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update with binary value",
    "query": "update t_user set name = _binary 'abc' where id = 1",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set name = _binary 'abc' where id = 1",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set `name` = _binary 'abc' where id = 1",
        "Table": "t_user",
        "Values": [
          "INT64(1)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update with alias table",
    "query": "update t_user u set u.name = 'john' where u.col > 20",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user u set u.name = 'john' where u.col > 20",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user as u set u.`name` = 'john' where u.col > 20",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update with routing using multi column vindex",
    "query": "update t_user set a = 1 where (name, col) in (('aa', 'bb'), ('cc', 'dd'))",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set a = 1 where (name, col) in (('aa', 'bb'), ('cc', 'dd'))",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "MultiEqual-MultiEqual",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set a = 1 where (`name`, col) in (('aa', 'bb'), ('cc', 'dd'))",
        "Table": "t_user",
        "Values": [
          "(VARCHAR(\"aa\"), VARCHAR(\"cc\"))"
        ],
        "TableValues": [
          "(VARCHAR(\"bb\"), VARCHAR(\"dd\"))"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update in shard key",
    "query": "update t_user set a = 123 where id in (4,5,6)",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set a = 123 where id in (4,5,6)",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "IN-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set a = 123 where id in (4, 5, 6)",
        "Table": "t_user",
        "Values": [
          "(INT64(4), INT64(5), INT64(6))"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update in split table key",
    "query": "update t_user set a = 123 where col in (4,5,6)",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set a = 123 where col in (4,5,6)",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-IN",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set a = 123 where col in (4, 5, 6)",
        "Table": "t_user",
        "TableValues": [
          "(INT64(4), INT64(5), INT64(6))"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update in",
    "query": "update t_user set a = 123 where b in (4,5,6)",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set a = 123 where b in (4,5,6)",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "Scatter-Scatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set a = 123 where b in (4, 5, 6)",
        "Table": "t_user"
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "update primary vindex columns",
    "query": "update t_user set id = 123",
    "plan": "VT12001: unsupported: you cannot UPDATE primary vindex columns; invalid update on vindex: user_index"
  },
  {
    "comment": "update split table column",
    "query": "update t_user set col = 123",
    "plan": "VT12001: unsupported: DML cannot update tablevindex column"
  },
  {
    "comment": "debug case",
    "query": "update t_user set a='a' where b=5 limit 7",
    "plan": "VT12001: unsupported: multi shard UPDATE with LIMIT"
  },
  {
    "comment": "debug case",
    "query": "update t_user set a='a' where id=4 and col=5 limit 7",
    "plan": {
      "QueryType": "UPDATE",
      "Original": "update t_user set a='a' where id=4 and col=5 limit 7",
      "Instructions": {
        "OperatorType": "TableUpdate",
        "Variant": "EqualUnique-EqualUnique",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "Queries": "update t_user set a = 'a' where id = 4 and col = 5 limit 7",
        "Table": "t_user",
        "TableValues": [
          "INT64(5)"
        ],
        "Values": [
          "INT64(4)"
        ]
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "sharded upsert with sharding key set to vindex and tablevindex column",
    "query": "insert into t_music(user_id, id, a) values(1, 2, 'a') on duplicate key update user_id = values(user_id)",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_music(user_id, id, a) values(1, 2, 'a') on duplicate key update user_id = values(user_id)",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "InsertIgnore": true,
        "Query": "insert into t_music(user_id, id, a) values (:_user_id_0, :_id_0, :_a_0) on duplicate key update user_id = values(user_id)",
        "TableName": "t_music",
        "VindexValues": {
          "music_user_map": "INT64(2)",
          "user_index": "INT64(1)"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\")"
        }
      },
      "TablesUsed": [
        "user.t_music"
      ]
    }
  },
  {
    "comment": "sharded bulk upsert with sharding key set to vindex column",
    "query": "insert into t_music(user_id, id , a) values (1, 2, 'a'), (3,4,'a') on duplicate key update user_id = values(user_id)",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_music(user_id, id , a) values (1, 2, 'a'), (3,4,'a') on duplicate key update user_id = values(user_id)",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "InsertIgnore": true,
        "Query": "insert into t_music(user_id, id, a) values (:_user_id_0, :_id_0, :_a_0), (:_user_id_1, :_id_1, :_a_1) on duplicate key update user_id = values(user_id)",
        "TableName": "t_music",
        "VindexValues": {
          "music_user_map": "INT64(2), INT64(4)",
          "user_index": "INT64(1), INT64(3)"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\"), VARCHAR(\"a\")"
        }
      },
      "TablesUsed": [
        "user.t_music"
      ]
    }
  },
  {
    "comment": "sharded insert subquery in insert value",
    "query": "insert into t_user(id, val, col) values((select 1), 1, 'a')",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_user(id, val, col) values((select 1), 1, 'a')",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(INT64(1))",
        "Query": "insert into t_user(id, val, col, `Name`, Costly) values (:_Id_0, 1, :_col_0, :_Name_0, :_Costly_0)",
        "TableName": "t_user",
        "VindexValues": {
          "costly_map": "NULL",
          "name_user_map": "NULL",
          "user_index": ":__seq0"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\")"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "insert no column list for sharded authoritative table",
    "query": "insert into t_authoritative values(1, 2, 3)",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_authoritative values(1, 2, 3)",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "Query": "insert into t_authoritative(user_id, col1, col2) values (:_user_id_0, :_col1_0, 3)",
        "TableName": "t_authoritative",
        "VindexValues": {
          "user_index": "INT64(1)"
        },
        "TableVindexValues": {
          "split_table_hash": "INT64(2)"
        }
      },
      "TablesUsed": [
        "user.t_authoritative"
      ]
    }
  },
  {
    "comment": "insert ignore sharded",
    "query": "insert ignore into t_user(id,col) values (1,'a')",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert ignore into t_user(id,col) values (1,'a')",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(INT64(1))",
        "InsertIgnore": true,
        "Query": "insert ignore into t_user(id, col, `Name`, Costly) values (:_Id_0, :_col_0, :_Name_0, :_Costly_0)",
        "TableName": "t_user",
        "VindexValues": {
          "costly_map": "NULL",
          "name_user_map": "NULL",
          "user_index": ":__seq0"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\")"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "insert into a vindex not allowed",
    "query": "insert into t_user(id,col) values(1,col) on duplicate key update col = 2",
    "plan": "VT12001: unsupported: DML cannot update tablevindex column"
  },
  {
    "comment": "insert into a vindex not allowed",
    "query": "insert into t_user(id) values(1)",
    "plan": "VT12001: unsupported: INSERT without splittable column"
  },
  {
    "comment": "insert into select ",
    "query": "insert into t_user(id,col) select id ,col from t_user",
    "plan": "VT12001: unsupported: Unsupport split table insert into select"
  },
  {
    "comment": "insert on duplicate key",
    "query": "insert into t_user(id,col) values(1,'col') on duplicate key update intcol = 2",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_user(id,col) values(1,'col') on duplicate key update intcol = 2",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(INT64(1))",
        "InsertIgnore": true,
        "Query": "insert into t_user(id, col, `Name`, Costly) values (:_Id_0, :_col_0, :_Name_0, :_Costly_0) on duplicate key update intcol = 2",
        "TableName": "t_user",
        "VindexValues": {
          "costly_map": "NULL",
          "name_user_map": "NULL",
          "user_index": ":__seq0"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"col\")"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "insert with default seq",
    "query": "insert into t_user(id, nonid,col) values (default, 2,'a')",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_user(id, nonid,col) values (default, 2,'a')",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(NULL)",
        "Query": "insert into t_user(id, nonid, col, `Name`, Costly) values (:_Id_0, 2, :_col_0, :_Name_0, :_Costly_0)",
        "TableName": "t_user",
        "VindexValues": {
          "costly_map": "NULL",
          "name_user_map": "NULL",
          "user_index": ":__seq0"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\")"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "insert with multiple rows",
    "query": "insert into t_user(id,col) values (1,'a'), (2,'b')",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_user(id,col) values (1,'a'), (2,'b')",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(INT64(1), INT64(2))",
        "Query": "insert into t_user(id, col, `Name`, Costly) values (:_Id_0, :_col_0, :_Name_0, :_Costly_0), (:_Id_1, :_col_1, :_Name_1, :_Costly_1)",
        "TableName": "t_user",
        "VindexValues": {
          "costly_map": "NULL, NULL",
          "name_user_map": "NULL, NULL",
          "user_index": ":__seq0, :__seq1"
        },
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"a\"), VARCHAR(\"b\")"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  },
  {
    "comment": "insert with all vindexes supplied",
    "query": "insert into t_user(nonid, name, id, col) values (2, 'foo', 1, 'col')",
    "plan": {
      "QueryType": "INSERT",
      "Original": "insert into t_user(nonid, name, id, col) values (2, 'foo', 1, 'col')",
      "Instructions": {
        "OperatorType": "Insert",
        "Variant": "TableSharded",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        },
        "TargetTabletType": "PRIMARY",
        "AutoIncrement": "select next :n /* INT64 */ values from seq:Values::(INT64(1))",
        "Query": "insert into t_user(nonid, `name`, id, col, Costly) values (2, :_Name_0, :_Id_0, :_col_0, :_Costly_0)",
        "TableName": "t_user",
        "TableVindexValues": {
          "split_table_hash": "VARCHAR(\"col\")"
        },
        "VindexValues": {
          "costly_map": "NULL",
          "name_user_map": "VARCHAR(\"foo\")",
          "user_index": ":__seq0"
        }
      },
      "TablesUsed": [
        "user.t_user"
      ]
    }
  }
]
