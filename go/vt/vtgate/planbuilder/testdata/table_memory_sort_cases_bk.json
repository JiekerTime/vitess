[
  {
    "comment": "order by on a cross-shard derived table",
    "query": "select id from (select user.id, user.col from user join user_extra) as t order by id",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select id from (select user.id, user.col from user join user_extra) as t order by id",
      "Instructions": {
        "OperatorType": "Join",
        "Variant": "Join",
        "JoinColumnIndexes": "L:0",
        "TableName": "`user`_user_extra",
        "Inputs": [
          {
            "OperatorType": "Route",
            "Variant": "Scatter",
            "Keyspace": {
              "Name": "user",
              "Sharded": true
            },
            "FieldQuery": "select id, weight_string(id) from (select `user`.id, `user`.col from `user` where 1 != 1) as t where 1 != 1",
            "OrderBy": "(0|1) ASC",
            "Query": "select id, weight_string(id) from (select `user`.id, `user`.col from `user`) as t order by id asc",
            "Table": "`user`"
          },
          {
            "OperatorType": "Route",
            "Variant": "Scatter",
            "Keyspace": {
              "Name": "user",
              "Sharded": true
            },
            "FieldQuery": "select 1 from user_extra where 1 != 1",
            "Query": "select 1 from user_extra",
            "Table": "user_extra"
          }
        ]
      },
      "TablesUsed": [
        "user.user",
        "user.user_extra"
      ]
    }
  },
  {
    "comment": "Order by for join, on text column in LHS.",
    "query": "select u.a, u.textcol1, un.col2 from user u join unsharded un order by u.textcol1, un.col2",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select u.a, u.textcol1, un.col2 from user u join unsharded un order by u.textcol1, un.col2",
      "Instructions": {
        "OperatorType": "Sort",
        "Variant": "Memory",
        "OrderBy": "1 ASC COLLATE latin1_swedish_ci, (2|3) ASC",
        "ResultColumns": 3,
        "Inputs": [
          {
            "OperatorType": "Join",
            "Variant": "Join",
            "JoinColumnIndexes": "L:0,L:1,R:0,R:1",
            "TableName": "`user`_unsharded",
            "Inputs": [
              {
                "OperatorType": "Route",
                "Variant": "Scatter",
                "Keyspace": {
                  "Name": "user",
                  "Sharded": true
                },
                "FieldQuery": "select u.a, u.textcol1 from `user` as u where 1 != 1",
                "Query": "select u.a, u.textcol1 from `user` as u",
                "Table": "`user`"
              },
              {
                "OperatorType": "Route",
                "Variant": "Unsharded",
                "Keyspace": {
                  "Name": "main",
                  "Sharded": false
                },
                "FieldQuery": "select un.col2, weight_string(un.col2) from unsharded as un where 1 != 1",
                "Query": "select un.col2, weight_string(un.col2) from unsharded as un",
                "Table": "unsharded"
              }
            ]
          }
        ]
      },
      "TablesUsed": [
        "main.unsharded",
        "user.user"
      ]
    }
  },
  {
    "comment": "Order by for join, on text column in RHS.",
    "query": "select u.a, u.textcol1, un.col2 from unsharded un join user u order by u.textcol1, un.col2",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select u.a, u.textcol1, un.col2 from unsharded un join user u order by u.textcol1, un.col2",
      "Instructions": {
        "OperatorType": "Sort",
        "Variant": "Memory",
        "OrderBy": "1 ASC COLLATE latin1_swedish_ci, (2|3) ASC",
        "ResultColumns": 3,
        "Inputs": [
          {
            "OperatorType": "Join",
            "Variant": "Join",
            "JoinColumnIndexes": "R:0,R:1,L:0,L:1",
            "TableName": "unsharded_`user`",
            "Inputs": [
              {
                "OperatorType": "Route",
                "Variant": "Unsharded",
                "Keyspace": {
                  "Name": "main",
                  "Sharded": false
                },
                "FieldQuery": "select un.col2, weight_string(un.col2) from unsharded as un where 1 != 1",
                "Query": "select un.col2, weight_string(un.col2) from unsharded as un",
                "Table": "unsharded"
              },
              {
                "OperatorType": "Route",
                "Variant": "Scatter",
                "Keyspace": {
                  "Name": "user",
                  "Sharded": true
                },
                "FieldQuery": "select u.a, u.textcol1 from `user` as u where 1 != 1",
                "Query": "select u.a, u.textcol1 from `user` as u",
                "Table": "`user`"
              }
            ]
          }
        ]
      },
      "TablesUsed": [
        "main.unsharded",
        "user.user"
      ]
    }
  },
  {
    "comment": "order by for vindex func",
    "query": "select id, keyspace_id, range_start, range_end from user_index where id = :id order by range_start",
    "plan": {
      "QueryType": "SELECT",
      "Original": "select id, keyspace_id, range_start, range_end from user_index where id = :id order by range_start",
      "Instructions": {
        "OperatorType": "Sort",
        "Variant": "Memory",
        "OrderBy": "2 ASC",
        "Inputs": [
          {
            "OperatorType": "VindexFunc",
            "Variant": "VindexMap",
            "Columns": [
              0,
              1,
              2,
              3
            ],
            "Fields": {
              "id": "VARBINARY",
              "keyspace_id": "VARBINARY",
              "range_end": "VARBINARY",
              "range_start": "VARBINARY"
            },
            "Value": ":id",
            "Vindex": "user_index"
          }
        ]
      },
      "TablesUsed": [
        "user_index"
      ]
    }
  }
]
